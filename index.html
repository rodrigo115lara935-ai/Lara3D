<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f0f11">
    <link rel="manifest" href="manifest.json">
    <title>Lara 3D - Pro</title>
    <style>
        :root {
            --bg: #0f0f11;
            --surface: #1c1c1e;
            --input-bg: #2c2c2e;
            --text-main: #ffffff;
            --text-sec: #8e8e93;
            --accent: #0a84ff;
            --accent-grad: linear-gradient(135deg, #0a84ff, #5e5ce6);
            --danger: #ff453a;
            --success: #32d74b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
        }

        .app-container { max-width: 420px; margin: 0 auto; padding-bottom: 50px; }

        header { text-align: center; margin-bottom: 30px; }
        h1 { font-size: 20px; font-weight: 600; margin: 0; letter-spacing: -0.5px; }
        .subtitle { font-size: 13px; margin-top: 5px; text-transform: uppercase; letter-spacing: 2px; font-weight: bold; color: var(--accent); }

        .input-group { margin-bottom: 20px; }
        .label-text { display: block; font-size: 11px; color: var(--text-sec); margin-bottom: 8px; font-weight: 500; text-transform: uppercase; }

        .input-row { display: flex; gap: 12px; }
        .input-wrapper { flex: 1; position: relative; }

        input {
            width: 100%; background-color: var(--input-bg); border: none; padding: 14px 12px;
            border-radius: 12px; color: var(--text-main); font-size: 16px; box-sizing: border-box;
        }
        
        input:focus { outline: 2px solid var(--accent); }
        .qty-wrapper input { text-align: center; font-weight: 700; font-size: 18px; background: var(--surface); border: 1px solid #333; }
        .currency-input input { padding-left: 25px; }
        .currency-symbol { position: absolute; left: 10px; top: 14px; color: var(--text-sec); font-size: 16px; }

        button {
            width: 100%; background: var(--accent-grad); color: white; padding: 16px; border: none;
            border-radius: 14px; font-size: 17px; font-weight: 600; cursor: pointer; margin-top: 10px;
        }

        details { margin-top: 25px; background: var(--surface); border-radius: 12px; overflow: hidden; }
        summary { padding: 15px; font-size: 13px; color: var(--text-sec); cursor: pointer; list-style: none; display: flex; justify-content: space-between; }
        .config-content { padding: 15px; padding-top: 0; }

        .result-modal {
            display: none; margin-top: 30px; background: var(--surface); border-radius: 20px;
            padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .price-hero { text-align: center; margin-bottom: 25px; }
        .price-value { font-size: 36px; font-weight: 700; color: var(--text-main); letter-spacing: -1px; margin: 5px 0; }
        .stat-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        .stat-label { color: var(--text-sec); }
        .val-profit { color: var(--success); font-weight: bold; }
        .val-warn { color: var(--danger); }

        .production-card { margin-top: 25px; border-top: 1px dashed #333; padding-top: 20px; }
        .prod-grid { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; }
        .prod-item { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 10px 2px; text-align: center; }
        .prod-val { font-size: 13px; font-weight: 700; display: block; }
        .prod-label { font-size: 9px; color: #666; }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>Cotizador 3D</h1>
        <div class="subtitle">Lara 3D</div>
    </header>

    <div class="input-group">
        <label class="label-text">Proyecto & Entrega</label>
        <div class="input-row">
            <div class="input-wrapper" style="flex: 2;"><input type="text" id="nombreProducto" placeholder="Nombre"></div>
            <div class="input-wrapper" style="flex: 1.5;"><input type="date" id="fechaEntrega"></div>
        </div>
    </div>

    <div class="input-group">
        <label class="label-text">Cantidad Total de Piezas</label>
        <div class="qty-wrapper"><input type="number" id="cantidadTotal" value="1"></div>
    </div>

    <div class="input-group">
        <label class="label-text">Datos por Unidad</label>
        <div class="input-row">
            <div class="input-wrapper"><input type="number" id="pesoPieza" placeholder="Peso (g)"></div>
            <div class="input-wrapper"><input type="number" id="tiempoMinutos" placeholder="Tiempo (m)"></div>
        </div>
    </div>

    <div class="input-group">
        <label class="label-text">Extras (Argollas | Bolsas | Pintura)</label>
        <div class="input-row">
            <div class="input-wrapper"><input type="number" id="cantArgollas" placeholder="Argollas"></div>
            <div class="input-wrapper"><input type="number" id="cantBolsas" placeholder="Bolsas"></div>
            <div class="input-wrapper currency-input"><span class="currency-symbol">$</span><input type="number" id="costoPintura" placeholder="Pintura"></div>
        </div>
    </div>

    <details>
        <summary>Configuración (160%) <span>⚙️</span></summary>
        <div class="config-content">
            <div class="input-row" style="margin-top:15px;">
                <div class="input-wrapper"><label class="label-text">Amort/h</label><input type="number" id="amortizacionHora" value="3.00"></div>
                <div class="input-wrapper"><label class="label-text">Mant/h</label><input type="number" id="mantenimientoHora" value="1.50"></div>
            </div>
            <div class="input-row" style="margin-top:15px;">
                <div class="input-wrapper"><label class="label-text">$/kWh</label><input type="number" id="precioLuz" value="4.00"></div>
                <div class="input-wrapper"><label class="label-text">Margen %</label><input type="number" id="margen" value="160"></div>
            </div>
        </div>
    </details>

    <button onclick="calcular()">Calcular Cotización</button>

    <div id="resultadoPanel" class="result-modal">
        <div class="price-hero">
            <div class="price-label" id="resNombre">PRODUCTO</div>
            <div class="price-value" id="resPrecioUnitario">$0.00</div>
            <div style="font-size:12px; color:var(--text-sec)" id="resFecha">Fecha</div>
        </div>

        <div class="stat-row"><span class="stat-label">Costo Directo Lote</span><span class="stat-val" id="rowCostoDirecto">$0.00</span></div>
        <div class="stat-row"><span class="stat-label">Ganancia Bruta</span><span class="stat-val" id="rowGananciaBruta">$0.00</span></div>
        <div class="stat-row"><span class="stat-label">Reserva Máquina</span><span class="stat-val val-warn" id="rowReserva">$0.00</span></div>
        <div class="stat-row"><span class="stat-label" style="color:white">Ganancia Neta</span><span class="stat-val val-profit" id="rowGananciaNeta">$0.00</span></div>

        <div class="production-card">
            <div class="prod-grid">
                <div class="prod-item"><span class="prod-val" id="reqTiempo">0h</span><span class="prod-label">Tiempo</span></div>
                <div class="prod-item"><span class="prod-val" id="reqFilamento">0g</span><span class="prod-label">Filam.</span></div>
                <div class="prod-item"><span class="prod-val" id="reqArgollas">0</span><span class="prod-label">Argol.</span></div>
                <div class="prod-item"><span class="prod-val" id="reqBolsas">0</span><span class="prod-label">Bolsas</span></div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('fechaEntrega').valueAsDate = new Date();

    function calcular() {
        let n = document.getElementById('nombreProducto').value || "LARA 3D";
        let f = document.getElementById('fechaEntrega').value;
        let c = parseFloat(document.getElementById('cantidadTotal').value) || 1;
        let p = parseFloat(document.getElementById('pesoPieza').value) || 0;
        let m = parseFloat(document.getElementById('tiempoMinutos').value) || 0;
        let a = parseFloat(document.getElementById('cantArgollas').value) || 0;
        let b = parseFloat(document.getElementById('cantBolsas').value) || 0;
        let pin = parseFloat(document.getElementById('costoPintura').value) || 0;
        let marg = parseFloat(document.getElementById('margen').value) || 160;
        let l = parseFloat(document.getElementById('precioLuz').value) || 4;
        let am = parseFloat(document.getElementById('amortizacionHora').value) || 3;
        let mt = parseFloat(document.getElementById('mantenimientoHora').value) || 1.5;

        let h = m / 60;
        let u_costoDirecto = ((300/1000)*p) + (h * 0.2 * l) + (a*1) + (b*1) + pin;
        let u_ganBruta = u_costoDirecto * (marg/100);
        let u_precioVenta = u_costoDirecto + u_ganBruta;
        let u_reserva = h * (am + mt);

        document.getElementById('resNombre').innerText = n.toUpperCase();
        document.getElementById('resFecha').innerText = "Entrega: " + f;
        document.getElementById('resPrecioUnitario').innerText = "$" + u_precioVenta.toFixed(2);
        document.getElementById('rowCostoDirecto').innerText = "$" + (u_costoDirecto * c).toFixed(2);
        document.getElementById('rowGananciaBruta').innerText = "$" + (u_ganBruta * c).toFixed(2);
        document.getElementById('rowReserva').innerText = "-$" + (u_reserva * c).toFixed(2);
        document.getElementById('rowGananciaNeta').innerText = "$" + ((u_ganBruta - u_reserva) * c).toFixed(2);
        
        document.getElementById('reqTiempo').innerText = Math.floor((m*c)/60) + "h " + Math.round((m*c)%60) + "m";
        document.getElementById('reqFilamento').innerText = (p*c).toFixed(0) + "g";
        document.getElementById('reqArgollas').innerText = (a*c).toFixed(0);
        document.getElementById('reqBolsas').innerText = (b*c).toFixed(0);

        document.getElementById('resultadoPanel').style.display = "block";
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // Service Worker Offline
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
                const name = 'lara3d-v1';
                self.addEventListener('install', e => e.waitUntil(caches.open(name).then(c => c.addAll(['./', './index.html', './manifest.json']))));
                self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
            `));
        });
    }
</script>
</body>
</html>
